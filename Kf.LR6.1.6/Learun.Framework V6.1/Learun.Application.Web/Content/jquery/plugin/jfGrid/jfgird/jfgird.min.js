(function(a){a.jfGird=a.jfGird||{};a.extend(a.jfGird,{render:function(c){var b=c[0].dfop;c.html("");c.addClass("jfgird-layout");a.jfGird.renderHead(c);a.jfGird.renderBorder(c);a.jfGird.renderLeft(c);a.jfGird.renderScorllArea(c);a.jfGird.renderPageBarinit(c);c.append('<div class="jfgird-move-line" id="jfgird_move_line_'+c[0].dfop.id+'"  ></div>');c.append('<div class="jfgird-nodata-img" id="jfgird_nodata_img_'+c[0].dfop.id+'"  ></div>');c.append('<div class="jfgird-loading" id="jfgird_loading_'+c[0].dfop.id+'"  ><div class="bg"></div><div class="img">正在拼命加载列表数据…</div></div>');c.on("mousedown",a.jfGird.bindmdown);c.on("click",a.jfGird.bindClick);c.mousemove(a.jfGird.bindmmove);c.on("mouseover",a.jfGird.bindmover);if(!!b.rowdatas&&!b.url){a.jfGird.renderData(c)}b=null;return},renderHead:function(l){var g=l[0].dfop;g._headWidth=0;g._leftWidth=0;g._headHeight=0;g._colModel=[];g._colFrozenModel=[];var h=a('<div class="jfgird-head" id="jfgird_head_'+g.id+'" ></div>');var n=a('<div class="jfgird-border" id="jfgird_border_'+g.id+'" ></div>');var e=a('<div class="jfgird-border-col" id="jfgird_border_col_'+g.id+'" ></div>');var f=g.headData.length;for(var d=0;d<f;d++){var m=g.headData[d];var b=m.frozen?g._leftWidth:g._headWidth;m.height=28;var k=a('<div class="jfgird-head-cell jfgird-heed-rownum_0" path="'+d+'" >'+(m.label||"")+"</div>");m.obj=k;m.path=d;if(!!m.children){if(m.frozen){a.jfGird.renderSubHead(e,m,g,g._leftWidth,1,true,d)}else{a.jfGird.renderSubHead(h,m,g,g._headWidth,1,false,d)}}else{k.attr("jfgird-heed-cellrender","ok");k.append('<div class="jfgird-heed-sort"><i class="fa fa-caret-up"></i><i class="fa fa-caret-down"></i></div>');k.append('<div class="jfgird-heed-move"></div>');if(m.frozen){g._colFrozenModel[g._colFrozenModel.length]=m}else{g._colModel[g._colModel.length]=m}m.type="datacol"}m.left=b;k.css({"width":((m.width||100)+"px"),"text-align":(m.align||"left"),"left":(b+"px")});g._headHeight=g._headHeight>m.height?g._headHeight:m.height;if(m.frozen){g._leftWidth+=m.width;e.append(k)}else{g._headWidth+=m.width;h.append(k)}}if(g._headHeight>28){h.find('.jfgird-heed-rownum_0[jfgird-heed-cellrender="ok"]').css({"height":(g._headHeight+"px"),"line-height":((g._headHeight-1)+"px")});e.find('.jfgird-heed-rownum_0[jfgird-heed-cellrender="ok"]').css({"height":(g._headHeight+"px"),"line-height":((g._headHeight-1)+"px")});for(var c=0;c<f;c++){var m=g.headData[c];if(!!m.children&&m.height<g._headHeight){if(!!m.children){a.jfGird.renderSubHeadToo(m.children,g._headHeight-m.height)}else{m.obj.css({"height":(g._headHeight-m.height+28+"px"),"line-height":((g._headHeight-m.height+27)+"px")})}}}}n.append(e);l.append(n);l.append(h);g=null},renderSubHead:function(l,d,k,e,c,b,o){d.width=0;var f=d.children;var j=f.length;var g=28;for(var h=0;h<j;h++){var n=f[h];n.height=28;n.parent=d;var m=a('<div class="jfgird-head-cell jfgird-heed-rownum_'+c+'" path="'+o+"."+h+'" >'+(n.label||"")+"</div>");n.obj=m;n.path=h;if(!!n.children){a.jfGird.renderSubHead(l,n,k,e+d.width,c+1,b,o+"."+h)}else{m.attr("jfgird-heed-cellrender","ok");m.append('<div class="jfgird-heed-sort"><i class="fa fa-caret-up"></i><i class="fa fa-caret-down"></i></div>');m.append('<div class="jfgird-heed-move"></div>');if(b){n.frozen=true;k._colFrozenModel[k._colFrozenModel.length]=n}else{k._colModel[k._colModel.length]=n}n.type="datacol"}n.left=e+d.width;m.css({"width":((n.width||100)+"px"),"text-align":(n.align||e),"left":(e+d.width+"px"),"top":(c*28+"px")});d.width+=n.width;g=n.height>g?n.height:g;l.append(m)}if(g>28){l.find(".jfgird-heed-rownum_"+c+'[jfgird-heed-cellrender="ok"]').css({"height":(g+"px"),"line-height":((g-1)+"px")})}d.height+=g},renderSubHeadToo:function(e,b){var c=e.length;for(var d=0;d<c;d++){var f=e[d].obj;if(!!e[d].children){a.jfGird.renderSubHeadToo(e[d].children,b)}else{f.css({"height":(b+e[d].height+"px"),"line-height":((e[d].height+b-1)+"px")})}}},renderBorder:function(h){var f=h[0].dfop;var e=h.find("#jfgird_border_"+f.id);var c=h.find("#jfgird_head_"+f.id);var b=0;if(f.isShowNum){var d=a('<div class="jfgird-border-cell jfgird-border-num"></div>');e.prepend(d);b+=30}if(f.isMultiselect){var i=a('<div class="jfgird-border-cell jfgird-border-cb"><input role="checkbox" id="jfgird_all_cb_'+f.id+'" type="checkbox"></div>').css("left",b+"px").css("line-height",(f._headHeight-1)+"px");e.prepend(i);b+=30}if(f.isSubGrid){var g=a('<div class="jfgird-border-cell jfgird-border-sub"></div>').css("left",b+"px");e.prepend(g);b+=30}f._borderLeftPadding=b;f._leftWidth+=b;e.css({"width":(f._leftWidth+"px"),"height":(f._headHeight+"px"),"padding-left":(b+"px")});c.css({"width":(f._headWidth+"px"),"height":(f._headHeight+"px"),"left":(f._leftWidth+"px")});h.css({"padding-left":(f._leftWidth+"px"),"padding-top":(f._headHeight+"px")});f=null},renderLeft:function(d){var c=d[0].dfop;var b=a('<div class="jfgird-left" id="jfgird_left_'+c.id+'" ></div>');b.css({"width":(c._leftWidth+"px"),"top":(c._headHeight+"px")});d.append(b);c=null},renderScorllArea:function(d){var c=d[0].dfop;
var b=a('<div class="jfgird-scrollarea" id="jfgird_scrollarea_'+c.id+'" ><div class="jfgird-scrollarea-content" id="jfgird_scrollarea_content_'+c.id+'"  style="width:'+c._headWidth+'px;" ></div></div>');d.append(b);b.mCustomScrollbar({axis:"xy",callbacks:{whileScrolling:function(){var e=a(this.mcs.content)[0].jfGirdDfop;if(!!e){a("#jfgird_left_"+e.id).css("top",(e._headHeight+this.mcs.top)+"px");a("#jfgird_head_"+e.id).css("left",(e._leftWidth+this.mcs.left)+"px")}},onOverflowYNone:function(g){if(!!this.mcs){var f=a(this.mcs.content)[0].jfGirdDfop;a("#jfgird_left_"+f.id).css("top",f._headHeight+"px")}},onOverflowXNone:function(g){if(!!this.mcs){var f=a(this.mcs.content)[0].jfGirdDfop;a("#jfgird_head_"+f.id).css("left",f._leftWidth+"px")}}}});b.find("#jfgird_scrollarea_content_"+c.id).parent()[0].jfGirdDfop=c;c=null},renderPageBarinit:function(e){var c=e[0].dfop;if(c.isPage&&c.url){e.css({"padding-bottom":"35px"});var b=a('<div class="jfgird-page-bar" id="jfgird_page_bar_'+c.id+'"><div class="jfgird-page-bar-info" >无显示数据</div><ul class="pagination pagination-sm" id="jfgird_page_bar_num_'+c.id+'" ></ul></div>');e.append(b);var d=b.find("#jfgird_page_bar_num_"+c.id);d.on("click",a.jfGird.reloadPage)}c=null},renderPageBar:function(k){var h=k[0].dfop;var d=a("#jfgird_page_bar_"+h.id);var m=d.find("#jfgird_page_bar_num_"+h.id);var e="";var n="";if(h.rowdatas.length==0){e="无显示数据"}else{var c=h.pageparam;var f=(c.page-1)*c.rows+1;var j=f+h.rowdatas.length-1;e="显示第 "+f+" - "+j+" 条记录  <span>|</span> 检索到 "+c.records+" 条记录";if(c.total>1){var b=c.page-6;b=b<0?0:b;var l=b+10;if(l>c.total){l=c.total}if((l-b)<10){b=l-10}b=b<0?0:b;for(var g=b;g<l;g++){n+='<li><a href="javascript:void(0);" class=" pagebtn '+((g+1)==c.page?"active":"")+'" >'+(g+1)+"</a></li>"}}}m.html(n);d.find(".jfgird-page-bar-info").html(e);h=null},reload:function(c){var b=c[0].dfop;b.rowdatas=[];if(b.isPage){b.pageparam.page=1;b.pageparam.records=0;b.pageparam.total=0;b.param["pagination"]=JSON.stringify(b.pageparam);a.jfGird.ajaxLoad(c,b.url,b.param,function(d){if(d.code==200){b.rowdatas=d.data.rows;b.pageparam.page=d.data.page;b.pageparam.records=d.data.records;b.pageparam.total=d.data.total}a.jfGird.renderData(c);if(!!b.onRenderComplete){b.onRenderComplete(d.data.rows)}})}else{a.jfGird.ajaxLoad(c,b.url,b.param,function(d){if(d.code==200){b.rowdatas=d.data}a.jfGird.renderData(c);if(!!b.onRenderComplete){b.onRenderComplete(d.data.rows)}})}},reloadPage:function(h){var g=a(this);var i=a("#"+g.attr("id").replace("jfgird_page_bar_num_",""));var b=i[0].dfop;var f=h.target||h.srcElement;var d=a(f);if(d.hasClass("pagebtn")){var c=parseInt(d.text());if(c!=b.pageparam.page){g.find(".active").removeClass("active");d.addClass("active");b.pageparam.page=c;b.param["pagination"]=JSON.stringify(b.pageparam);a.jfGird.ajaxLoad(i,b.url,b.param,function(e){if(e.code==200){b.rowdatas=e.data.rows;b.pageparam.page=e.data.page;b.pageparam.records=e.data.records;b.pageparam.total=e.data.total}a.jfGird.renderData(i)})}}},renderData:function(c){var b=c[0].dfop;if(b.isPage){a.jfGird.renderRowData(c,b.rowdatas);a.jfGird.renderPageBar(c)}else{if(b.isTree){if(b.datatype!="tree"){b.rowdatas=a.jfGird.listTotree(b.rowdatas,b.parentId,b.mainId,b)}a.jfGird.renderTreeRowData(c,b.rowdatas)}else{a.jfGird.renderRowData(c,b.rowdatas)}}b=null},renderRowData:function(r,k){var p=r[0].dfop;var t=r.find("#jfgird_left_"+p.id);var s=r.find("#jfgird_scrollarea_content_"+p.id);var u=r.find("#jfgird_nodata_img_"+p.id);u.hide();var l;if(p.reloadSelected&&!p.isMultiselect){l=a.jfGird.getSelectedRow(r)}t.html("");s.html("");k=k||[];var o=k.length;for(var j=0;j<o;j++){var e=k[j];var g=null;var q="rownum_"+p.id+"_"+j;t.append('<div class="jfgird-data-cell jfgird-hide-cell" rownum="'+q+'"  datapath="'+j+'" ></div>');if(p.isShowNum){var c=a('<div class="jfgird-data-cell jfgird-tool-cell" rownum="'+q+'" colname="jfgird_rownum"  >'+(j+1)+"</div>");t.append(c);g=c}if(p.isMultiselect){var c=a('<div class="jfgird-data-cell jfgird-tool-cell" rownum="'+q+'" colname="jfgird_multiselect" ><input role="checkbox" type="checkbox"></div>');t.append(c);g=c}if(p.isSubGrid){var c=a('<div class="jfgird-data-cell jfgird-tool-cell" rownum="'+q+'" colname="jfgird_subGrid"><i class="fa fa-plus jfgird_expend" rownum="'+q+'" ></i></div>');t.append(c);g=c}for(var f=0,h=p._colFrozenModel.length;f<h;f++){var c=a('<div class="jfgird-data-cell" rownum="'+q+'"  colname="'+p._colFrozenModel[f].name+'" style="width:'+p._colFrozenModel[f].width+"px;text-align:"+p._colFrozenModel[f].align+';"  title="'+(e[p._colFrozenModel[f].name]||"")+'" ></div>');if(f==h-1){g=c}a.jfGird.getCellHtml(p._colFrozenModel[f],e,p,c);t.append(c)}if(!!g){g.addClass("jfgird-data-cell-last")}for(var d=0,b=p._colModel.length;d<b;d++){var c=a('<div class="jfgird-data-cell" rownum="'+q+'" colname="'+p._colModel[d].name+'" style="width:'+p._colModel[d].width+"px;text-align:"+p._colModel[d].align+';" title="'+(e[p._colModel[d].name]||"")+'"  ></div>');if(d==b-1){c.addClass("jfgird-data-cell-last")
}a.jfGird.getCellHtml(p._colModel[d],e,p,c);s.append(c)}if(p.reloadSelected&&!p.isMultiselect&&!!l&&e[p.mainId]==l[p.mainId]){r.find('.jfgird-data-cell[rownum="'+q+'"]').addClass("jfgird-head-cell-selected").addClass("jfgird_selected_"+p.id)}}if(o==0){u.show()}p=null},renderTreeRowData:function(g,c){var e=g[0].dfop;var i=g.find("#jfgird_left_"+e.id);var h=g.find("#jfgird_scrollarea_content_"+e.id);var j=g.find("#jfgird_nodata_img_"+e.id);var d;if(e.reloadSelected&&!e.isMultiselect){d=a.jfGird.getSelectedRow(g)}var f=0;j.hide();i.html("");h.html("");c=c||[];if(c.length>0){b(c,1,"")}else{j.show()}function b(p,y,z){for(var w=0,t=p.length;w<t;w++){var r=p[w];var x=a('<div class="jfgird-data-cell-expend" style="width:'+(y*16)+'px;" ></div>');r["jfgird_rownum"]=f;var A="rownum_"+e.id+"_"+f;var u=null;i.append('<div class="jfgird-data-cell jfgird-hide-cell"  rownum="'+A+'"  datapath="'+z+w+'" ></div>');if(e.isShowNum){var o=a('<div class="jfgird-data-cell jfgird-tool-cell" rownum="'+A+'" colname="jfgird_rownum"  >'+(f+1)+"</div>");i.append(o);u=o}if(e.isMultiselect){var o=a('<div class="jfgird-data-cell jfgird-tool-cell" rownum="'+A+'" colname="jfgird_multiselect" ><input role="checkbox" type="checkbox"></div>');i.append(o);u=o}if(e.isSubGrid){var o=a('<div class="jfgird-data-cell jfgird-tool-cell" rownum="'+A+'" colname="jfgird_subGrid"><i class="fa fa-plus jfgird_expend" rownum="'+A+'" ></i></div>');i.append(o);u=o}for(var s=0,v=e._colFrozenModel.length;s<v;s++){var o=a('<div class="jfgird-data-cell" rownum="'+A+'"  colname="'+e._colFrozenModel[s].name+'" style="width:'+e._colFrozenModel[s].width+"px;text-align:"+e._colFrozenModel[s].align+';"  title="'+(r[e._colFrozenModel[s].name]||"")+'" >'+(r[e._colFrozenModel[s].name]||"")+"</div>");a.jfGird.getCellHtml(e._colFrozenModel[s],r,e,o);if(s==0){o.prepend(x)}if(s==v-1){u=o}i.append(o)}if(!!u){u.addClass("jfgird-data-cell-last")}for(var q=0,k=e._colModel.length;q<k;q++){var o=a('<div class="jfgird-data-cell" rownum="'+A+'" colname="'+e._colModel[q].name+'" style="width:'+e._colModel[q].width+"px;text-align:"+e._colModel[q].align+';" title="'+(r[e._colModel[q].name]||"")+'"  >'+(r[e._colModel[q].name]||"")+"</div>");a.jfGird.getCellHtml(e._colModel[q],r,e,o);if(q==0&&e._colFrozenModel.length==0){o.prepend(x)}if(q==k-1){o.addClass("jfgird-data-cell-last")}h.append(o)}if(e.reloadSelected&&!e.isMultiselect&&!!d&&r[e.mainId]==d[e.mainId]){g.find('.jfgird-data-cell[rownum="'+A+'"]').addClass("jfgird-head-cell-selected").addClass("jfgird_selected_"+e.id)}f++;if(r.jfGird_ChildRows.length>0){x.append('<i class="fa fa-caret-down jfgird-data-cell-expendi"></i>');b(r.jfGird_ChildRows,y+1,z+w+".")}}}e=null},renderPage:function(e){var b=a("#jfgird_page_bar_"+e.id);if(!!e._pagination&&e._pagination.total>1){var d=a('<li title="上一页" ><a href="#" aria-label="上一页"><span aria-hidden="true">&laquo;</span></a></li>');var c=a('<li title="下一页"><a href="#" aria-label="下一页"><span aria-hidden="true">&raquo;</span></a></li>')}},getCellHtml:function(e,g,d,b){var c="";var f=g[e.name];if(!!e.formatter){c=e.formatter(f,g,d);b.html(c)}else{if(e.formatterAsync){e.formatterAsync(function(h){h=h||"";b.html(h)},f,g,d)}else{c=f;if(f==null||f==undefined||f=="null"||f=="undefined"){c=""}b.html(c)}}},bindClick:function(g){var f=a(this);var b=f[0].dfop;var d=g.target||g.srcElement;var c=a(d);if(b.isHeadWidhChange){a.jfGird.moveHeadWidth(b,false);b.isHeadWidhChange=false}else{if(c.hasClass("jfgird-head-cell")){a.jfGird.sortCol(c,b)}else{if((c.hasClass("jfgird_expend")&&c.parent().hasClass("jfgird-data-cell"))||(c.hasClass("jfgird-data-cell")&&c.find(".jfgird_expend").length>0)){a.jfGird.expandSubGrid(c,b)}else{if(c.hasClass("jfgird-data-cell-expendi")){a.jfGird.expandTree(c,b)}else{if(c.hasClass("jfgird-data-cell")||c.parents(".jfgird-data-cell").length>0){a.jfGird.selectRow(f,c,b);g.stopPropagation()}else{if(c.attr("id")==("jfgird_all_cb_"+b.id)){a.jfGird.selectAllRow(f,c,b)}}}}}}},bindmdown:function(i){var h=a(this);var c=h[0].dfop;var g=i.target||i.srcElement;var d=a(g);if(d.hasClass("jfgird-heed-move")){var f=d.parent().attr("path");var b=a("#jfgird_move_line_"+c.id);c._currentMoveCell=a.jfGird.getHeadCell(f,c.headData);c._currentMoveCell.pageX=i.pageX;c._currentMoveLeft=0;if(c._currentMoveCell.frozen){c._currentMoveLeft=c._borderLeftPadding+c._currentMoveCell.left+c._currentMoveCell.width}else{c._currentMoveLeft=c._leftWidth+c._currentMoveCell.left+c._currentMoveCell.width}c._currentMoveWidth=c._currentMoveCell.width;b.css("left",c._currentMoveLeft+"px");b.show();c.isHeadWidhChange=true}},bindmmove:function(d){var c=a(this);var b=c[0].dfop;if(b.isHeadWidhChange){a.jfGird.moveHeadWidth(b,true,d.pageX)}b=null},bindmover:function(g){var f=a(this);f.find(".jfgird-data-cell-over").removeClass("jfgird-data-cell-over");var d=g.target||g.srcElement;var c=a(d);if(c.hasClass("jfgird-data-cell")||c.parents(".jfgird-data-cell").length>0){var b=c.attr("rownum");if(!b){b=c.parents(".jfgird-data-cell").attr("rownum")
}f.find('[rownum="'+b+'"]').addClass("jfgird-data-cell-over")}},moveHeadWidth:function(i,h,g){var j=a("#jfgird_move_line_"+i.id);if(h){var d=i._currentMoveCell.width+(g-i._currentMoveCell.pageX);d=(d<40?40:d);var e=i._currentMoveLeft+(d-i._currentMoveCell.width);i._currentMoveWidth=d;j.css("left",e+"px")}else{if(i._currentMoveWidth!=i._currentMoveCell.width){var f=i._currentMoveWidth-i._currentMoveCell.width;i._currentMoveCell.width=i._currentMoveWidth;i._currentMoveCell.obj.css("width",i._currentMoveCell.width+"px");var b=i._currentMoveCell.parent;var k=i._currentMoveCell;a.jfGird.refreshHead(k.frozen,i,b,k,f)}j.hide()}},getHeadCell:function(f,e){var g=f.split(".");var d=e;for(var c=0,b=g.length;c<b;c++){if(c==b-1){return d[g[c]]}d=d[g[c]].children}},refreshHead:function(b,n,e,o,f){function g(t){for(var p=0,c=t.length;p<c;p++){var u=t[p];u.left=u.left+f;u.obj.css("left",u.left+"px");if(!!u.children){g(u.children)}}}while(e){for(var j=o.path+1,h=e.children.length;j<h;j++){var s=e.children[j];s.left=s.left+f;s.obj.css("left",s.left+"px");if(!!s.children){g(s.children)}}e.width=e.width+f;e.obj.css("width",e.width+"px");o=e;e=e.parent}for(var j=o.path+1,h=n.headData.length;j<h;j++){var s=n.headData[j];if(s.frozen==b){s.left=s.left+f;s.obj.css("left",s.left+"px");if(!!s.children){g(s.children)}}}var k=a("#"+n.id);var m=k.find("#jfgird_head_"+n.id);if(!!b){var r=k.find("#jfgird_border_"+n.id);var d=k.find("#jfgird_left_"+n.id);n._leftWidth=n._leftWidth+f;k.css("padding-left",n._leftWidth+"px");r.css("width",n._leftWidth+"px");d.css("width",n._leftWidth+"px");m.css("left",n._leftWidth+"px")}else{n._headWidth=n._headWidth+f;m.css("width",n._headWidth+"px");var q=k.find("#jfgird_scrollarea_content_"+n.id);q.css("width",n._headWidth+"px");if(f>0){a("#jfgird_scrollarea_"+n.id).mCustomScrollbar("update")}else{k.css("width","10000px");a("#jfgird_scrollarea_"+n.id).mCustomScrollbar("update");k.css("width","100%")}}k.find('.jfgird-data-cell[colname="'+n._currentMoveCell.name+'"]').css("width",n._currentMoveCell.width+"px")},selectRow:function(f,e,d){var g=e;var c=e.attr("rownum");if(!c){g=e.parents(".jfgird-data-cell");c=g.attr("rownum")}var b=".jfgird_selected_"+d.id;if(d.isMultiselect){if(e.attr("role")=="checkbox"){if(g.hasClass("jfgird-head-cell-selected")){f.find(b+'[rownum="'+c+'"]').removeClass("jfgird-head-cell-selected").removeClass("jfgird_selected_"+d.id);if(a("#jfgird_all_cb_"+d.id).is(":checked")){d._cancelallcb=true;a("#jfgird_all_cb_"+d.id).trigger("click")}}else{f.find('[rownum="'+c+'"]').addClass("jfgird-head-cell-selected").addClass("jfgird_selected_"+d.id)}}else{f.find('.jfgird-tool-cell[rownum="'+c+'"] input[role="checkbox"]').trigger("click")}}else{f.find(b).removeClass("jfgird-head-cell-selected").removeClass("jfgird_selected_"+d.id);f.find('[rownum="'+c+'"]').addClass("jfgird-head-cell-selected").addClass("jfgird_selected_"+d.id)}if(d.onSelectRow){d.onSelectRow(a.jfGird.getSelectedRow(f))}},selectAllRow:function(d,c,b){if(c.is(":checked")){d.find('.jfgird-tool-cell [role="checkbox"]').not(":checked").trigger("click")}else{if(!b._cancelallcb){d.find('.jfgird-tool-cell [role="checkbox"]:checked').trigger("click")}b._cancelallcb=false}},sortCol:function(d,c){var e=d.attr("path");var b=a.jfGird.getHeadCell(e,c.headData);if(b.type=="datacol"&&b.sort){if(!!c.sortcell){c.sortcell.obj.find(".jfgird-heed-sort").hide();if(b==c.sortcell){var f=c.sortcell.obj.find(".jfgird-heed-sort .active");f.removeClass("active");if(f.hasClass("fa-caret-up")){c.sortcell.obj.find(".jfgird-heed-sort .fa-caret-down").addClass("active")}else{c.sortcell.obj.find(".jfgird-heed-sort .fa-caret-up").addClass("active")}c.sortcell.obj.find(".jfgird-heed-sort").show()}else{b.obj.find(".jfgird-heed-sort .active").removeClass("active");b.obj.find(".jfgird-heed-sort .fa-caret-up").addClass("active");b.obj.find(".jfgird-heed-sort").show()}}else{b.obj.find(".jfgird-heed-sort .active").removeClass("active");b.obj.find(".jfgird-heed-sort .fa-caret-up").addClass("active");b.obj.find(".jfgird-heed-sort").show()}c.sortcell=b}},expandSubGrid:function(g,f){var h=g;if(!g.hasClass("jfgird_expend")){h=g.find(".jfgird_expend")}var e=g.attr("rownum");var j=a("#jfgird_scrollarea_content_"+f.id);var b=a("#jfgird_left_"+f.id);var l=j.find('.jfgird-data-cell-last[rownum="'+e+'"]');var c=b.find('.jfgird-data-cell-last[rownum="'+e+'"]');if(c.next().find(".jfgird_chlidgird").length>0){c.next().remove();l.next().remove();h.removeClass("fa-minus");h.addClass("fa-plus")}else{h.removeClass("fa-plus");h.addClass("fa-minus");var k="jfgird_chlidgird_content_"+f.id+"_"+e;var d='<div class="jfgird-subgird-cell" for-rownum="rowId" style="width:'+f._leftWidth+"px;height:"+f.subGridHeight+'px;" >';d+='<div class="jfgird_chlidgird" style="width:'+(a("#jfgird_scrollarea_"+f.id).width()+f._leftWidth)+"px;padding-left:"+f._borderLeftPadding+'px;" ><div class="jfgird_subgird_left" style="width:'+f._borderLeftPadding+'px;" ></div>';d+='<div class="jfgird-chlidgird-content" id="'+k+'"></div>';
d+="</div></div>";c.after(d);l.after('<div class="jfgird-data-cell" for-rownum="rowId" style="width:'+f._headWidth+"px;height:"+f.subGridHeight+'px;" ></div>');if(!!f.subGridRowExpanded){var i=a("#"+f.id).find('.jfgird-hide-cell[rownum="'+e+'"]').attr("datapath");var m=a.jfGird.getRowDataByPath(f,i);f.subGridRowExpanded(k,m)}}},expandTree:function(d,c){var g=a("#"+c.id);var b=d.parent().parent().attr("rownum");var f=g.find('.jfgird-hide-cell[rownum="'+b+'"]').attr("datapath");var i=a.jfGird.getRowDataByPath(c,f);if(d.hasClass("fa-caret-down")){i._isclosed=true;h(g,i.jfGird_ChildRows);d.removeClass("fa-caret-down");d.addClass("fa-caret-right")}else{i._isclosed=false;e(g,i.jfGird_ChildRows);d.removeClass("fa-caret-right");d.addClass("fa-caret-down")}function e(q,p){var o=q[0].dfop;for(var m=0,j=p.length;m<j;m++){var k="rownum_"+o.id+"_"+p[m].jfgird_rownum;q.find('[rownum="'+k+'"]').not(".jfgird-hide-cell").show();if(p[m].jfGird_ChildRows.length>0&&!p[m]._isclosed){var n=p[m].jfGird_ChildRows;e(q,n)}}}function h(p,o){for(var m=0,j=o.length;m<j;m++){var k="rownum_"+c.id+"_"+o[m].jfgird_rownum;p.find('[rownum="'+k+'"]').hide();if(o[m].jfGird_ChildRows.length>0&&!o[m]._isclosed){var n=o[m].jfGird_ChildRows;h(p,n)}}}},listTotree:function(g,h,n,j){var c=[];var k={};var m={};var o={};j._maprowdatas={};g=g||[];for(var f=0,d=g.length;f<d;f++){var p=g[f];m[p[n]]=1;k[p[h]]=k[p[h]]||[];k[p[h]].push(p);if(m[p[h]]==1){delete o[p[h]]}else{o[p[h]]=1}if(o[p[n]]==1){delete o[p[n]]}}for(var b in o){e(c,b)}function e(s,t){var u=k[t]||[];for(var q=0,i=u.length;q<i;q++){var r=u[q];r.jfGird_ChildRows=[];e(r.jfGird_ChildRows,r[n]);s.push(r);j._maprowdatas[r[n]]=r}}return c},treeTolist:function(c){var b=[];d(c);function d(j){for(var h=0,f=j.length;h<f;h++){var e={};for(var g in j[h]){if(g!="jfGird_ChildRows"){e[g]=j[h][g]}}b.push(e);if(j[h].jfGird_ChildRows.length>0){d(j[h].jfGird_ChildRows)}}}return b},getSelectedRow:function(e){var d=e[0].dfop;var c;var b=[];e.find(".jfgird_selected_"+d.id+"[datapath]").each(function(){var f=a(this).attr("datapath");if(!!f){c=a.jfGird.getRowDataByPath(d,f);b.push(c)}});if(b.length>1){return b}else{return c}},getRowDataByPath:function(e,h){var d=h.split(".");var g=e.rowdatas;var f=null;for(var c=0,b=d.length;c<b;c++){f=g[d[c]];if(!f){return null}g=f.jfGird_ChildRows}return f},addTreeRow:function(d,b){var c=b.row;c.jfGird_ChildRows=[];b.rowdatas=b.rowdatas||[];b._maprowdatas=b._maprowdatas||{};if(b._maprowdatas[c[b.parentId]]){b._maprowdatas[c[b.parentId]].jfGird_ChildRows.push(c)}else{b.rowdatas.push(c)}b._maprowdatas[c[b.mainId]]=c;a.jfGird.renderTreeRowData(d,b.rowdatas)},addRow:function(d,b){var b=d[0].dfop;var c=b.row;b.rowdatas.push(c);a.jfGird.renderRowData(d,b.rowdatas);b=null},updateRow:function(d,b){var c=a.jfGird.getSelectedRow(d);if(!!c){a.extend(c,b.row);if(!b.isPage&&b.isTree){a.jfGird.renderTreeRowData(d,b.rowdatas)}else{a.jfGird.renderRowData(d,b.rowdatas)}}},removeRow:function(h,e){var g=a(h.find(".jfgird-head-cell-selected[datapath]")[0]).attr("datapath");if(!!g){var d=g.split(".");var f=e.rowdatas;for(var c=0,b=d.length;c<b;c++){if(c==(b-1)){f.splice(d[c],1);break}else{f=f[d[c]].jfGird_ChildRows}}if(!e.isPage&&e.isTree){a.jfGird.renderTreeRowData(h,e.rowdatas)}else{a.jfGird.renderRowData(h,e.rowdatas)}}},loading:function(e,b){var c=e[0].dfop;var d=a("#jfgird_loading_"+c.id);if(b){d.show()}else{d.hide()}c=null},ajaxLoad:function(d,b,c,e){a.jfGird.loading(d,true);a.ajax({url:b,data:c,type:"GET",dataType:"json",async:true,cache:false,success:function(f){e(f);a.jfGird.loading(d,false)},error:function(f,h,g){e({code:500})},beforeSend:function(){},complete:function(){a.jfGird.loading(d,false)}})}});a.fn.jfGird=function(e){var c=a(this);var d=c.attr("id");if(d==null||d==undefined||d==""){d="jfgrid"+new Date().getTime();c.attr("id",d)}var b={url:"",param:{},rowdatas:[],datatype:"array",headData:[],isShowNum:true,isMultiselect:false,isSubGrid:false,subGridRowExpanded:false,subGridHeight:300,onSelectRow:false,onRenderComplete:false,isPage:false,pageparam:{rows:50,page:1,sidx:"",sord:"",records:0,total:0},sidx:"",sord:"ASC",isTree:false,mainId:"id",parentId:"parentId",reloadSelected:false};if(!!e){a.extend(b,e)}b.id=d;c[0].dfop=b;b.pageparam.sidx=b.sidx;b.pageparam.sord=b.sord;a.jfGird.render(c);b=null;return c};a.fn.jfGirdSet=function(b,f){var d=a(this);var e=d.attr("id");if(e==null||e==undefined||e==""){return null}var c=d[0].dfop;if(!c){return null}if(!!f){a.extend(c,f)}switch(b){case"reload":a.jfGird.reload(d);break;case"refreshdata":a.jfGird.renderData(d);break;case"addRow":if(!c.isPage&&c.isTree){a.jfGird.addTreeRow(d,c)}else{a.jfGird.addRow(d,c)}break;case"updateRow":a.jfGird.updateRow(d,c);break;case"removeRow":a.jfGird.removeRow(d,c);break}c=null};a.fn.jfGirdGet=function(b){var d=a(this);var e=d.attr("id");if(e==null||e==undefined||e==""){return null}var c=d[0].dfop;if(!c){return null}switch(b){case"rowdata":return a.jfGird.getSelectedRow(d);break;case"rowdatas":return c.rowdatas;break;
case"rowdatasByArray":return a.jfGird.treeTolist(c.rowdatas);break}c=null};a.fn.jfGirdValue=function(e){var f=a(this);var g=f.attr("id");if(g==null||g==undefined||g==""){return null}var c=f[0].dfop;if(!c){return null}var d=a.jfGird.getSelectedRow(f);if(!!d){var b="";if(d.length>0){a.each(d,function(i,h){if(b!=""){b+=","}b+=h[e]||""});return b}else{return d[e]||""}}else{return""}}})(window.jQuery);